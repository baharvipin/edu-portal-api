generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model School {
  id     String  @id @default(uuid())
  name   String
  board  String
  city   String
  state  String
  email  String  @unique
  system String?

  profileCompleted Boolean      @default(false)
  isActive         Boolean      @default(true)
  status           SchoolStatus @default(PROFILE_INCOMPLETE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  admins   Admin[]
  profile  SchoolProfile?
  teachers Teacher[]
  classes  Class[]
  sections Section[]
  students Student[]
}

model Admin {
  id       String @id @default(uuid())
  name     String
  email    String @unique
  password String

  schoolId String?
  school   School? @relation(fields: [schoolId], references: [id])

  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  role      Role     @default(NONE)

  teacher Teacher?
  student Student? // âœ… ADD THIS
  status  UserStatus @default(INVITED)
}

model Teacher {
  id                 String    @id @default(uuid())
  userId             String    @unique
  schoolId           String
  fullName           String
  email              String?
  phone              String?
  subjects           TeacherSubject[]
  isActive           Boolean   @default(false)
  mustChangePassword Boolean   @default(true) // ðŸ‘ˆ NEW COLUMN
  user               Admin     @relation(fields: [userId], references: [id])
  school             School    @relation(fields: [schoolId], references: [id])

  createdAt DateTime @default(now())
}

model Subject {
  id       String  @id @default(dbgenerated("gen_random_uuid()"))
  code     String? // optional field, can be required if you want
  name     String
  schoolId String
 
  teacherSubjects TeacherSubject[] // âœ… REQUIRED
}

enum UserStatus {
  INVITED
  ACTIVE
  SUSPENDED
}

model SchoolProfile {
  id       String @id @default(uuid())
  schoolId String @unique
  school   School @relation(fields: [schoolId], references: [id])

  fullAddress        String
  registrationNumber String
  medium             String
  yearEstablished    Int

  classes       String
  academicYear  String
  schoolTimings String
  gradingSystem String

  hasLabs      Boolean @default(false)
  hasTransport Boolean @default(false)
  hasHostel    Boolean @default(false)

  logoUrl             String?
  registrationCertUrl String?
  boardAffiliationUrl String?

  attendanceMode   String
  notificationMode String

  examsModuleEnabled    Boolean @default(false)
  homeworkModuleEnabled Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum SchoolStatus {
  PROFILE_INCOMPLETE // Just registered
  PROFILE_SUBMITTED // Profile completed, waiting for approval
  ACTIVE // Approved & live
  INACTIVE // Admin deactivated
  SUSPENDED // Policy violation
  REJECTED // Rejected by SuperAdmin
}

enum Role {
  SUPER_ADMIN
  ADMIN
  STUDENT
  TEACHER
  NONE
}

model Student {
  id String @id @default(uuid())

 userId    String? @unique   // ðŸ‘ˆ make optional temporarily
  schoolId  String
  firstName String
  lastName  String
  email     String @unique
  phone     String

  classId   String
  sectionId String

  parentName  String
  parentPhone String

  isActive  Boolean   @default(false)
  deletedAt DateTime?

  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  mustChangePassword Boolean  @default(true) // ðŸ‘ˆ REQUIRED
  user               Admin?    @relation(fields: [userId], references: [id])
  school             School   @relation(fields: [schoolId], references: [id])
  class              Class    @relation(fields: [classId], references: [id])
  section            Section  @relation(fields: [sectionId], references: [id])
}

model Class {
  id          String @id @default(uuid())
  schoolId    String
  name        String // e.g. "1", "2", "10", "12"
  displayName String // e.g. "Class 10"
  order       Int? // for sorting (optional)

  isActive  Boolean   @default(true)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  school   School    @relation(fields: [schoolId], references: [id])
  sections Section[]
  students Student[]

  @@unique([schoolId, name])
}

model Section {
  id       String @id @default(uuid())
  schoolId String
  classId  String
  name     String // A, B, C

  isActive  Boolean   @default(true)
  deletedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  school   School    @relation(fields: [schoolId], references: [id])
  class    Class     @relation(fields: [classId], references: [id])
  students Student[]

  @@unique([classId, name])
}
model TeacherSubject {
  id        String   @id @default(dbgenerated("gen_random_uuid()"))

  teacherId String
  subjectId String
  schoolId  String

  teacher   Teacher @relation(fields: [teacherId], references: [id])
  subject   Subject @relation(fields: [subjectId], references: [id])

  assignedAt DateTime @default(now())
  isActive   Boolean  @default(true)

  @@unique([teacherId, subjectId])
}
